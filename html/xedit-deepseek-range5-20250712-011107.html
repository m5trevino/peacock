<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü¶ö Peacock XEdit Interface (Optimized)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'SF Mono', monospace; background: #0d1117; color: #e6edf3; height: 100vh; overflow: hidden; }
        .header { background: #161b22; border-bottom: 1px solid #30363d; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; }
        .peacock-logo { font-size: 18px; font-weight: bold; color: #ff6b35; }
        .nav-links { display: flex; gap: 16px; align-items: center; }
        .nav-link { background: #21262d; border: 1px solid #30363d; color: #e6edf3; padding: 8px 16px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; }
        .nav-link.active { background: #ff6b35; color: #0d1117; }
        .project-info { color: #8b949e; font-size: 14px; }
        .session-info { background: rgba(0, 255, 136, 0.1); border: 1px solid #00ff88; border-radius: 6px; padding: 4px 8px; font-size: 12px; color: #00ff88; }
        .optimization-badge { background: rgba(255, 107, 53, 0.1); border: 1px solid #ff6b35; border-radius: 6px; padding: 4px 8px; font-size: 12px; color: #ff6b35; margin-left: 8px; }
        .main-container { display: flex; height: calc(100vh - 60px); }
        .left-panel { width: 320px; background: #161b22; border-right: 1px solid #30363d; display: flex; flex-direction: column; }
        .panel-header { background: #21262d; padding: 12px 16px; border-bottom: 1px solid #30363d; font-weight: 600; font-size: 13px; color: #7c3aed; display: flex; justify-content: space-between; align-items: center; }
        .optimization-info { font-size: 11px; color: #ff6b35; }
        .functions-list { flex: 1; overflow-y: auto; padding: 8px; }
        .function-item { background: #21262d; border: 1px solid #30363d; border-radius: 6px; padding: 12px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s; position: relative; }
        .function-item:hover { border-color: #ff6b35; background: #2d333b; transform: translateX(3px); }
        .function-item.selected { border-color: #ff6b35; background: #2d333b; box-shadow: 0 0 0 1px #ff6b35; }
        .function-info { display: flex; align-items: center; gap: 8px; }
        .function-name { font-weight: 600; color: #79c0ff; }
        .function-type { background: #30363d; color: #8b949e; padding: 2px 6px; border-radius: 3px; font-size: 10px; text-transform: uppercase; }
        .model-indicator { background: #ff6b35; color: #0d1117; padding: 2px 4px; border-radius: 3px; font-size: 10px; margin-left: auto; }
        .add-btn { position: absolute; top: 8px; right: 8px; background: #238636; border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 14px; opacity: 0; transition: opacity 0.2s; }
        .function-item:hover .add-btn { opacity: 1; }
        .middle-panel { width: 340px; background: #161b22; border-right: 1px solid #30363d; display: flex; flex-direction: column; }
        .payload-header { background: #238636; color: white; padding: 12px 16px; font-weight: 600; font-size: 14px; text-align: center; }
        .payload-container { flex: 1; padding: 16px; display: flex; flex-direction: column; }
        .payload-list { flex: 1; background: #21262d; border: 1px solid #30363d; border-radius: 8px; padding: 16px; margin-bottom: 16px; overflow-y: auto; min-height: 200px; }
        .payload-empty { color: #6e7681; text-align: center; font-style: italic; margin-top: 50px; }
        .payload-item { background: #2d333b; border: 1px solid #30363d; border-radius: 6px; padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .payload-item-info { display: flex; flex-direction: column; gap: 4px; }
        .xedit-id { font-family: 'SF Mono', monospace; background: #30363d; color: #ff6b35; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .payload-model { font-size: 10px; color: #8b949e; }
        .remove-btn { background: #da3633; border: none; color: white; width: 20px; height: 20px; border-radius: 3px; cursor: pointer; font-size: 12px; }
        .strategy-overview { background: rgba(255, 107, 53, 0.1); border: 1px solid #ff6b35; border-radius: 8px; padding: 12px; margin-bottom: 16px; }
        .strategy-title { color: #ff6b35; font-size: 12px; font-weight: 600; margin-bottom: 8px; }
        .strategy-models { font-size: 10px; color: #8b949e; line-height: 1.4; }
        .send-button { width: 100%; background: #238636; border: none; color: white; padding: 15px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; margin-bottom: 15px; }
        .send-button:disabled { background: #30363d; color: #8b949e; cursor: not-allowed; }
        .deploy-section { padding: 15px; background: rgba(46, 204, 113, 0.1); border: 1px solid #2ecc71; border-radius: 8px; }
        .deploy-title { color: #2ecc71; margin-bottom: 10px; font-weight: 600; }
        .deploy-info { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-bottom: 10px; font-size: 12px; color: #8b949e; }
        .deploy-button { width: 100%; padding: 12px; background: linear-gradient(45deg, #2ecc71, #27ae60); border: none; border-radius: 6px; color: white; font-weight: 600; cursor: pointer; }
        .right-panel { flex: 1; background: #0d1117; display: flex; flex-direction: column; }
        .code-header { background: #21262d; padding: 12px 16px; border-bottom: 1px solid #30363d; font-weight: 600; font-size: 13px; color: #f0883e; display: flex; justify-content: space-between; align-items: center; }
        .model-status { font-size: 11px; color: #ff6b35; }
        .code-container { flex: 1; overflow: auto; padding: 16px; }
        .code-content { background: #161b22; border: 1px solid #30363d; border-radius: 6px; padding: 16px; font-family: 'SF Mono', monospace; font-size: 13px; line-height: 1.6; }
        .code-line { display: flex; min-height: 20px; }
        .code-line.highlighted { background: #2d333b; border-left: 3px solid #ff6b35; padding-left: 13px; }
        .line-number { color: #6e7681; user-select: none; margin-right: 16px; min-width: 30px; text-align: right; }
        .line-content { color: #e6edf3; flex: 1; }
    </style>
</head>
<body>
    <div class="header">
        <div class="peacock-logo">ü¶ö Peacock XEdit Interface</div>
        <div class="nav-links">
            <div class="nav-link active">üìù XEdit</div>
            <div class="nav-link">ü§ñ Models</div>
            <div class="nav-link">üí¨ Senior Dev</div>
        </div>
        <div class="project-info">
            Project: Untitled Peacock Project ‚Ä¢ Session: <span class="session-info">deepseek-range5-20250712-011107</span>
            <span class="optimization-badge">Multi-Model</span>
        </div>
    </div>

    <div class="main-container">
        <div class="left-panel">
            <div class="panel-header">
                üìã Functions & Classes
                <span class="optimization-info">Optimized</span>
            </div>
            <div class="functions-list">
                
            <div class="function-item" onclick="highlightFunction('7x001', 'authMiddleware', 3, 13)" data-id="7x001">
                <div class="function-info">
                    <span class="function-icon">‚ö°</span>
                    <span class="function-name">authMiddleware</span>
                    <span class="function-type">function</span>
                    <span class="model-indicator">‚ö°</span>
                </div>
                <button class="add-btn" onclick="event.stopPropagation(); addToPayload('authMiddleware', 'function', '7x001')" title="Add to payload">+</button>
            </div>
            
            </div>
        </div>

        <div class="middle-panel">
            <div class="payload-header">Optimized Payload</div>
            <div class="payload-container">
                <div class="strategy-overview">
                    <div class="strategy-title">üß† Model Strategy</div>
                    <div class="strategy-models">
                        <strong>Code Analysis:</strong> llama3-8b-8192<br>
                        <strong>Structure:</strong> gemma2-9b-it<br>
                        <strong>Speed:</strong> llama3-8b-8192
                    </div>
                </div>
                
                <div class="payload-list" id="payload-list">
                    <div class="payload-empty">Click functions to add XEdit-Paths</div>
                </div>
                <button class="send-button" id="send-button" disabled>
                    üöÄ Send 0 to Optimized Pipeline
                </button>
                
                <div class="deploy-section">
                    <div class="deploy-title">üöÄ Deploy & Download</div>
                    <div class="deploy-info">
                        <strong>Project:</strong> Untitled Peacock Project<br>
                        <strong>Session:</strong> deepseek-range5-20250712-011107<br>
                        <strong>Strategy:</strong> Multi-Model Optimized
                    </div>
                    <button class="deploy-button" onclick="deployToPcock()">üì¶ Download Optimized Setup</button>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="code-header">
                üìÅ Untitled Peacock Project: Generated Code
                <span class="model-status">Multi-Model Ready</span>
            </div>
            <div class="code-container">
                <div class="code-content">
<div class="code-line" data-line="1"><span class="line-number">  1</span><span class="line-content">const express = require('express');</span></div>
<div class="code-line" data-line="2"><span class="line-number">  2</span><span class="line-content">const mongoose = require('mongoose');</span></div>
<div class="code-line" data-line="3"><span class="line-number">  3</span><span class="line-content">const cors = require('cors');</span></div>
<div class="code-line" data-line="4"><span class="line-number">  4</span><span class="line-content">const dotenv = require('dotenv');</span></div>
<div class="code-line" data-line="5"><span class="line-number">  5</span><span class="line-content"></span></div>
<div class="code-line" data-line="6"><span class="line-number">  6</span><span class="line-content">dotenv.config();</span></div>
<div class="code-line" data-line="7"><span class="line-number">  7</span><span class="line-content"></span></div>
<div class="code-line" data-line="8"><span class="line-number">  8</span><span class="line-content">const app = express();</span></div>
<div class="code-line" data-line="9"><span class="line-number">  9</span><span class="line-content"></span></div>
<div class="code-line" data-line="10"><span class="line-number"> 10</span><span class="line-content">// Connect to MongoDB</span></div>
<div class="code-line" data-line="11"><span class="line-number"> 11</span><span class="line-content">mongoose.connect(process.env.DB_URI, {</span></div>
<div class="code-line" data-line="12"><span class="line-number"> 12</span><span class="line-content">  useNewUrlParser: true,</span></div>
<div class="code-line" data-line="13"><span class="line-number"> 13</span><span class="line-content">  useUnifiedTopology: true</span></div>
<div class="code-line" data-line="14"><span class="line-number"> 14</span><span class="line-content">});</span></div>
<div class="code-line" data-line="15"><span class="line-number"> 15</span><span class="line-content"></span></div>
<div class="code-line" data-line="16"><span class="line-number"> 16</span><span class="line-content">// Middleware</span></div>
<div class="code-line" data-line="17"><span class="line-number"> 17</span><span class="line-content">app.use(cors());</span></div>
<div class="code-line" data-line="18"><span class="line-number"> 18</span><span class="line-content">app.use(express.json());</span></div>
<div class="code-line" data-line="19"><span class="line-number"> 19</span><span class="line-content"></span></div>
<div class="code-line" data-line="20"><span class="line-number"> 20</span><span class="line-content">// Routes</span></div>
<div class="code-line" data-line="21"><span class="line-number"> 21</span><span class="line-content">app.use('/api/users', require('./routes/userRoutes'));</span></div>
<div class="code-line" data-line="22"><span class="line-number"> 22</span><span class="line-content"></span></div>
<div class="code-line" data-line="23"><span class="line-number"> 23</span><span class="line-content">// Error handling middleware</span></div>
<div class="code-line" data-line="24"><span class="line-number"> 24</span><span class="line-content">app.use((err, req, res, next) =&gt; {</span></div>
<div class="code-line" data-line="25"><span class="line-number"> 25</span><span class="line-content">  console.error(err.stack);</span></div>
<div class="code-line" data-line="26"><span class="line-number"> 26</span><span class="line-content">  res.status(500).json({ error: 'Internal Server Error' });</span></div>
<div class="code-line" data-line="27"><span class="line-number"> 27</span><span class="line-content">});</span></div>
<div class="code-line" data-line="28"><span class="line-number"> 28</span><span class="line-content"></span></div>
<div class="code-line" data-line="29"><span class="line-number"> 29</span><span class="line-content">const PORT = process.env.PORT || 3000;</span></div>
<div class="code-line" data-line="30"><span class="line-number"> 30</span><span class="line-content">app.listen(PORT, () =&gt; {</span></div>
<div class="code-line" data-line="31"><span class="line-number"> 31</span><span class="line-content">  console.log(`Server running on port ${PORT}`);</span></div>
<div class="code-line" data-line="32"><span class="line-number"> 32</span><span class="line-content">});</span></div>
<div class="code-line" data-line="33"><span class="line-number"> 33</span><span class="line-content">const mongoose = require('mongoose');</span></div>
<div class="code-line" data-line="34"><span class="line-number"> 34</span><span class="line-content">const bcrypt = require('bcryptjs');</span></div>
<div class="code-line" data-line="35"><span class="line-number"> 35</span><span class="line-content"></span></div>
<div class="code-line" data-line="36"><span class="line-number"> 36</span><span class="line-content">const userSchema = new mongoose.Schema({</span></div>
<div class="code-line" data-line="37"><span class="line-number"> 37</span><span class="line-content">  email: {</span></div>
<div class="code-line" data-line="38"><span class="line-number"> 38</span><span class="line-content">    type: String,</span></div>
<div class="code-line" data-line="39"><span class="line-number"> 39</span><span class="line-content">    required: true,</span></div>
<div class="code-line" data-line="40"><span class="line-number"> 40</span><span class="line-content">    unique: true,</span></div>
<div class="code-line" data-line="41"><span class="line-number"> 41</span><span class="line-content">    trim: true,</span></div>
<div class="code-line" data-line="42"><span class="line-number"> 42</span><span class="line-content">    lowercase: true</span></div>
<div class="code-line" data-line="43"><span class="line-number"> 43</span><span class="line-content">  },</span></div>
<div class="code-line" data-line="44"><span class="line-number"> 44</span><span class="line-content">  password: {</span></div>
<div class="code-line" data-line="45"><span class="line-number"> 45</span><span class="line-content">    type: String,</span></div>
<div class="code-line" data-line="46"><span class="line-number"> 46</span><span class="line-content">    required: true,</span></div>
<div class="code-line" data-line="47"><span class="line-number"> 47</span><span class="line-content">    minlength: 8</span></div>
<div class="code-line" data-line="48"><span class="line-number"> 48</span><span class="line-content">  },</span></div>
<div class="code-line" data-line="49"><span class="line-number"> 49</span><span class="line-content">  tokens: [{</span></div>
<div class="code-line" data-line="50"><span class="line-number"> 50</span><span class="line-content">    token: {</span></div>
<div class="code-line" data-line="51"><span class="line-number"> 51</span><span class="line-content">      type: String,</span></div>
<div class="code-line" data-line="52"><span class="line-number"> 52</span><span class="line-content">      required: true</span></div>
<div class="code-line" data-line="53"><span class="line-number"> 53</span><span class="line-content">    }</span></div>
<div class="code-line" data-line="54"><span class="line-number"> 54</span><span class="line-content">  }]</span></div>
<div class="code-line" data-line="55"><span class="line-number"> 55</span><span class="line-content">});</span></div>
<div class="code-line" data-line="56"><span class="line-number"> 56</span><span class="line-content"></span></div>
<div class="code-line" data-line="57"><span class="line-number"> 57</span><span class="line-content">// Hash password before saving</span></div>
<div class="code-line" data-line="58"><span class="line-number"> 58</span><span class="line-content">userSchema.pre('save', async function (next) {</span></div>
<div class="code-line" data-line="59"><span class="line-number"> 59</span><span class="line-content">  if (this.isModified('password')) {</span></div>
<div class="code-line" data-line="60"><span class="line-number"> 60</span><span class="line-content">    this.password = await bcrypt.hash(this.password, 8);</span></div>
<div class="code-line" data-line="61"><span class="line-number"> 61</span><span class="line-content">  }</span></div>
<div class="code-line" data-line="62"><span class="line-number"> 62</span><span class="line-content">  next();</span></div>
<div class="code-line" data-line="63"><span class="line-number"> 63</span><span class="line-content">});</span></div>
<div class="code-line" data-line="64"><span class="line-number"> 64</span><span class="line-content"></span></div>
<div class="code-line" data-line="65"><span class="line-number"> 65</span><span class="line-content">const User = mongoose.model('User', userSchema);</span></div>
<div class="code-line" data-line="66"><span class="line-number"> 66</span><span class="line-content">module.exports = User;</span></div>
<div class="code-line" data-line="67"><span class="line-number"> 67</span><span class="line-content">const User = require('../models/User');</span></div>
<div class="code-line" data-line="68"><span class="line-number"> 68</span><span class="line-content">const jwt = require('jsonwebtoken');</span></div>
<div class="code-line" data-line="69"><span class="line-number"> 69</span><span class="line-content">const bcrypt = require('bcryptjs');</span></div>
<div class="code-line" data-line="70"><span class="line-number"> 70</span><span class="line-content"></span></div>
<div class="code-line" data-line="71"><span class="line-number"> 71</span><span class="line-content">// Register user</span></div>
<div class="code-line" data-line="72"><span class="line-number"> 72</span><span class="line-content">const registerUser = async (req, res) =&gt; {</span></div>
<div class="code-line" data-line="73"><span class="line-number"> 73</span><span class="line-content">  try {</span></div>
<div class="code-line" data-line="74"><span class="line-number"> 74</span><span class="line-content">    const { email, password } = req.body;</span></div>
<div class="code-line" data-line="75"><span class="line-number"> 75</span><span class="line-content">    const user = new User({ email, password });</span></div>
<div class="code-line" data-line="76"><span class="line-number"> 76</span><span class="line-content">    await user.save();</span></div>
<div class="code-line" data-line="77"><span class="line-number"> 77</span><span class="line-content">    res.status(201).json({ message: 'User created successfully' });</span></div>
<div class="code-line" data-line="78"><span class="line-number"> 78</span><span class="line-content">  } catch (error) {</span></div>
<div class="code-line" data-line="79"><span class="line-number"> 79</span><span class="line-content">    res.status(400).json({ error: error.message });</span></div>
<div class="code-line" data-line="80"><span class="line-number"> 80</span><span class="line-content">  }</span></div>
<div class="code-line" data-line="81"><span class="line-number"> 81</span><span class="line-content">};</span></div>
<div class="code-line" data-line="82"><span class="line-number"> 82</span><span class="line-content"></span></div>
<div class="code-line" data-line="83"><span class="line-number"> 83</span><span class="line-content">// Login user</span></div>
<div class="code-line" data-line="84"><span class="line-number"> 84</span><span class="line-content">const loginUser = async (req, res) =&gt; {</span></div>
<div class="code-line" data-line="85"><span class="line-number"> 85</span><span class="line-content">  try {</span></div>
<div class="code-line" data-line="86"><span class="line-number"> 86</span><span class="line-content">    const { email, password } = req.body;</span></div>
<div class="code-line" data-line="87"><span class="line-number"> 87</span><span class="line-content">    const user = await User.findOne({ email });</span></div>
<div class="code-line" data-line="88"><span class="line-number"> 88</span><span class="line-content">    if (!user || !(await bcrypt.compare(password, user.password))) {</span></div>
<div class="code-line" data-line="89"><span class="line-number"> 89</span><span class="line-content">      return res.status(401).json({ error: 'Invalid credentials' });</span></div>
<div class="code-line" data-line="90"><span class="line-number"> 90</span><span class="line-content">    }</span></div>
<div class="code-line" data-line="91"><span class="line-number"> 91</span><span class="line-content">    const token = jwt.sign({ id: user._id }, process.env.JWT_SECRET, { expiresIn: '1h' });</span></div>
<div class="code-line" data-line="92"><span class="line-number"> 92</span><span class="line-content">    user.tokens.push(token);</span></div>
<div class="code-line" data-line="93"><span class="line-number"> 93</span><span class="line-content">    await user.save();</span></div>
<div class="code-line" data-line="94"><span class="line-number"> 94</span><span class="line-content">    res.json({ token });</span></div>
<div class="code-line" data-line="95"><span class="line-number"> 95</span><span class="line-content">  } catch (error) {</span></div>
<div class="code-line" data-line="96"><span class="line-number"> 96</span><span class="line-content">    res.status(500).json({ error: error.message });</span></div>
<div class="code-line" data-line="97"><span class="line-number"> 97</span><span class="line-content">  }</span></div>
<div class="code-line" data-line="98"><span class="line-number"> 98</span><span class="line-content">};</span></div>
<div class="code-line" data-line="99"><span class="line-number"> 99</span><span class="line-content"></span></div>
<div class="code-line" data-line="100"><span class="line-number">100</span><span class="line-content">// Refresh token</span></div>
<div class="code-line" data-line="101"><span class="line-number">101</span><span class="line-content">const refreshToken = async (req, res) =&gt; {</span></div>
<div class="code-line" data-line="102"><span class="line-number">102</span><span class="line-content">  try {</span></div>
<div class="code-line" data-line="103"><span class="line-number">103</span><span class="line-content">    const { token } = req.body;</span></div>
<div class="code-line" data-line="104"><span class="line-number">104</span><span class="line-content">    const decoded = jwt.verify(token, process.env.JWT_SECRET);</span></div>
<div class="code-line" data-line="105"><span class="line-number">105</span><span class="line-content">    const user = await User.findById(decoded.id);</span></div>
<div class="code-line" data-line="106"><span class="line-number">106</span><span class="line-content">    if (!user) {</span></div>
<div class="code-line" data-line="107"><span class="line-number">107</span><span class="line-content">      return res.status(401).json({ error: 'Invalid token' });</span></div>
<div class="code-line" data-line="108"><span class="line-number">108</span><span class="line-content">    }</span></div>
<div class="code-line" data-line="109"><span class="line-number">109</span><span class="line-content">    const newToken = jwt.sign({ id: user._id }, process.env.JWT_SECRET, { expiresIn: '1h' });</span></div>
<div class="code-line" data-line="110"><span class="line-number">110</span><span class="line-content">    res.json({ token: newToken });</span></div>
<div class="code-line" data-line="111"><span class="line-number">111</span><span class="line-content">  } catch (error) {</span></div>
<div class="code-line" data-line="112"><span class="line-number">112</span><span class="line-content">    res.status(401).json({ error: 'Invalid token' });</span></div>
<div class="code-line" data-line="113"><span class="line-number">113</span><span class="line-content">  }</span></div>
<div class="code-line" data-line="114"><span class="line-number">114</span><span class="line-content">};</span></div>
<div class="code-line" data-line="115"><span class="line-number">115</span><span class="line-content"></span></div>
<div class="code-line" data-line="116"><span class="line-number">116</span><span class="line-content">module.exports = { registerUser, loginUser, refreshToken };</span></div>
<div class="code-line" data-line="117"><span class="line-number">117</span><span class="line-content">const express = require('express');</span></div>
<div class="code-line" data-line="118"><span class="line-number">118</span><span class="line-content">const router = express.Router();</span></div>
<div class="code-line" data-line="119"><span class="line-number">119</span><span class="line-content">const { registerUser, loginUser, refreshToken } = require('../controllers/userController');</span></div>
<div class="code-line" data-line="120"><span class="line-number">120</span><span class="line-content">const authMiddleware = require('../middleware/authMiddleware');</span></div>
<div class="code-line" data-line="121"><span class="line-number">121</span><span class="line-content"></span></div>
<div class="code-line" data-line="122"><span class="line-number">122</span><span class="line-content">// Public routes</span></div>
<div class="code-line" data-line="123"><span class="line-number">123</span><span class="line-content">router.post('/register', registerUser);</span></div>
<div class="code-line" data-line="124"><span class="line-number">124</span><span class="line-content">router.post('/login', loginUser);</span></div>
<div class="code-line" data-line="125"><span class="line-number">125</span><span class="line-content"></span></div>
<div class="code-line" data-line="126"><span class="line-number">126</span><span class="line-content">// Protected route</span></div>
<div class="code-line" data-line="127"><span class="line-number">127</span><span class="line-content">router.post('/refresh-token', authMiddleware, refreshToken);</span></div>
<div class="code-line" data-line="128"><span class="line-number">128</span><span class="line-content"></span></div>
<div class="code-line" data-line="129"><span class="line-number">129</span><span class="line-content">module.exports = router;</span></div>
<div class="code-line" data-line="130"><span class="line-number">130</span><span class="line-content">const jwt = require('jsonwebtoken');</span></div>
<div class="code-line" data-line="131"><span class="line-number">131</span><span class="line-content"></span></div>
<div class="code-line" data-line="132"><span class="line-number">132</span><span class="line-content">const authMiddleware = (req, res, next) =&gt; {</span></div>
<div class="code-line" data-line="133"><span class="line-number">133</span><span class="line-content">  const token = req.headers['x-access-token'];</span></div>
<div class="code-line" data-line="134"><span class="line-number">134</span><span class="line-content">  if (!token) {</span></div>
<div class="code-line" data-line="135"><span class="line-number">135</span><span class="line-content">    return res.status(401).json({ error: 'No token provided' });</span></div>
<div class="code-line" data-line="136"><span class="line-number">136</span><span class="line-content">  }</span></div>
<div class="code-line" data-line="137"><span class="line-number">137</span><span class="line-content">  try {</span></div>
<div class="code-line" data-line="138"><span class="line-number">138</span><span class="line-content">    const decoded = jwt.verify(token, process.env.JWT_SECRET);</span></div>
<div class="code-line" data-line="139"><span class="line-number">139</span><span class="line-content">    req.userId = decoded.id;</span></div>
<div class="code-line" data-line="140"><span class="line-number">140</span><span class="line-content">    next();</span></div>
<div class="code-line" data-line="141"><span class="line-number">141</span><span class="line-content">  } catch (error) {</span></div>
<div class="code-line" data-line="142"><span class="line-number">142</span><span class="line-content">    res.status(401).json({ error: 'Invalid token' });</span></div>
<div class="code-line" data-line="143"><span class="line-number">143</span><span class="line-content">  }</span></div>
<div class="code-line" data-line="144"><span class="line-number">144</span><span class="line-content">};</span></div>
<div class="code-line" data-line="145"><span class="line-number">145</span><span class="line-content"></span></div>
<div class="code-line" data-line="146"><span class="line-number">146</span><span class="line-content">module.exports = authMiddleware;</span></div>
<div class="code-line" data-line="147"><span class="line-number">147</span><span class="line-content">const request = require('supertest');</span></div>
<div class="code-line" data-line="148"><span class="line-number">148</span><span class="line-content">const app = require('../server');</span></div>
<div class="code-line" data-line="149"><span class="line-number">149</span><span class="line-content">const User = require('../models/User');</span></div>
<div class="code-line" data-line="150"><span class="line-number">150</span><span class="line-content">const jwt = require('jsonwebtoken');</span></div>
<div class="code-line" data-line="151"><span class="line-number">151</span><span class="line-content"></span></div>
<div class="code-line" data-line="152"><span class="line-number">152</span><span class="line-content">describe('User Controller Tests', () =&gt; {</span></div>
<div class="code-line" data-line="153"><span class="line-number">153</span><span class="line-content">  beforeEach(async () =&gt; {</span></div>
<div class="code-line" data-line="154"><span class="line-number">154</span><span class="line-content">    await User.deleteMany({});</span></div>
<div class="code-line" data-line="155"><span class="line-number">155</span><span class="line-content">  });</span></div>
<div class="code-line" data-line="156"><span class="line-number">156</span><span class="line-content"></span></div>
<div class="code-line" data-line="157"><span class="line-number">157</span><span class="line-content">  test('Should register a new user', async () =&gt; {</span></div>
<div class="code-line" data-line="158"><span class="line-number">158</span><span class="line-content">    const res = await request(app)</span></div>
<div class="code-line" data-line="159"><span class="line-number">159</span><span class="line-content">      .post('/api/users/register')</span></div>
<div class="code-line" data-line="160"><span class="line-number">160</span><span class="line-content">      .send({</span></div>
<div class="code-line" data-line="161"><span class="line-number">161</span><span class="line-content">        email: 'test@example.com',</span></div>
<div class="code-line" data-line="162"><span class="line-number">162</span><span class="line-content">        password: 'Password123!'</span></div>
<div class="code-line" data-line="163"><span class="line-number">163</span><span class="line-content">      });</span></div>
<div class="code-line" data-line="164"><span class="line-number">164</span><span class="line-content">    expect(res.statusCode).toBe(201);</span></div>
<div class="code-line" data-line="165"><span class="line-number">165</span><span class="line-content">    expect(res.body.message).toBe('User created successfully');</span></div>
<div class="code-line" data-line="166"><span class="line-number">166</span><span class="line-content">  });</span></div>
<div class="code-line" data-line="167"><span class="line-number">167</span><span class="line-content"></span></div>
<div class="code-line" data-line="168"><span class="line-number">168</span><span class="line-content">  test('Should login with valid credentials', async () =&gt; {</span></div>
<div class="code-line" data-line="169"><span class="line-number">169</span><span class="line-content">    // First create a user</span></div>
<div class="code-line" data-line="170"><span class="line-number">170</span><span class="line-content">    await request(app)</span></div>
<div class="code-line" data-line="171"><span class="line-number">171</span><span class="line-content">      .post('/api/users/register')</span></div>
<div class="code-line" data-line="172"><span class="line-number">172</span><span class="line-content">      .send({</span></div>
<div class="code-line" data-line="173"><span class="line-number">173</span><span class="line-content">        email: 'login@example.com',</span></div>
<div class="code-line" data-line="174"><span class="line-number">174</span><span class="line-content">        password: 'Password123!'</span></div>
<div class="code-line" data-line="175"><span class="line-number">175</span><span class="line-content">      });</span></div>
<div class="code-line" data-line="176"><span class="line-number">176</span><span class="line-content"></span></div>
<div class="code-line" data-line="177"><span class="line-number">177</span><span class="line-content">    const res = await request(app)</span></div>
<div class="code-line" data-line="178"><span class="line-number">178</span><span class="line-content">      .post('/api/users/login')</span></div>
<div class="code-line" data-line="179"><span class="line-number">179</span><span class="line-content">      .send({</span></div>
<div class="code-line" data-line="180"><span class="line-number">180</span><span class="line-content">        email: 'login@example.com',</span></div>
<div class="code-line" data-line="181"><span class="line-number">181</span><span class="line-content">        password: 'Password123!'</span></div>
<div class="code-line" data-line="182"><span class="line-number">182</span><span class="line-content">      });</span></div>
<div class="code-line" data-line="183"><span class="line-number">183</span><span class="line-content">    expect(res.statusCode).toBe(200);</span></div>
<div class="code-line" data-line="184"><span class="line-number">184</span><span class="line-content">    expect(res.body).toHaveProperty('token');</span></div>
<div class="code-line" data-line="185"><span class="line-number">185</span><span class="line-content">  });</span></div>
<div class="code-line" data-line="186"><span class="line-number">186</span><span class="line-content"></span></div>
<div class="code-line" data-line="187"><span class="line-number">187</span><span class="line-content">  test('Should return error for invalid login', async () =&gt; {</span></div>
<div class="code-line" data-line="188"><span class="line-number">188</span><span class="line-content">    const res = await request(app)</span></div>
<div class="code-line" data-line="189"><span class="line-number">189</span><span class="line-content">      .post('/api/users/login')</span></div>
<div class="code-line" data-line="190"><span class="line-number">190</span><span class="line-content">      .send({</span></div>
<div class="code-line" data-line="191"><span class="line-number">191</span><span class="line-content">        email: 'invalid@example.com',</span></div>
<div class="code-line" data-line="192"><span class="line-number">192</span><span class="line-content">        password: 'wrongpassword'</span></div>
<div class="code-line" data-line="193"><span class="line-number">193</span><span class="line-content">      });</span></div>
<div class="code-line" data-line="194"><span class="line-number">194</span><span class="line-content">    expect(res.statusCode).toBe(401);</span></div>
<div class="code-line" data-line="195"><span class="line-number">195</span><span class="line-content">    expect(res.body.error).toBe('Invalid credentials');</span></div>
<div class="code-line" data-line="196"><span class="line-number">196</span><span class="line-content">  });</span></div>
<div class="code-line" data-line="197"><span class="line-number">197</span><span class="line-content">});</span></div>
<div class="code-line" data-line="198"><span class="line-number">198</span><span class="line-content">FROM node:18</span></div>
<div class="code-line" data-line="199"><span class="line-number">199</span><span class="line-content">WORKDIR /app</span></div>
<div class="code-line" data-line="200"><span class="line-number">200</span><span class="line-content">COPY package*.json ./</span></div>
<div class="code-line" data-line="201"><span class="line-number">201</span><span class="line-content">RUN npm install</span></div>
<div class="code-line" data-line="202"><span class="line-number">202</span><span class="line-content">COPY . .</span></div>
<div class="code-line" data-line="203"><span class="line-number">203</span><span class="line-content">EXPOSE 3000</span></div>
<div class="code-line" data-line="204"><span class="line-number">204</span><span class="line-content">CMD ["node", "server.js"]</span></div>
<div class="code-line" data-line="205"><span class="line-number">205</span><span class="line-content">version: '3'</span></div>
<div class="code-line" data-line="206"><span class="line-number">206</span><span class="line-content">services:</span></div>
<div class="code-line" data-line="207"><span class="line-number">207</span><span class="line-content">  app:</span></div>
<div class="code-line" data-line="208"><span class="line-number">208</span><span class="line-content">    build: .</span></div>
<div class="code-line" data-line="209"><span class="line-number">209</span><span class="line-content">    ports:</span></div>
<div class="code-line" data-line="210"><span class="line-number">210</span><span class="line-content">      - "3000:3000"</span></div>
<div class="code-line" data-line="211"><span class="line-number">211</span><span class="line-content">    environment:</span></div>
<div class="code-line" data-line="212"><span class="line-number">212</span><span class="line-content">      DB_URI: mongodb://db:27017/restful-api</span></div>
<div class="code-line" data-line="213"><span class="line-number">213</span><span class="line-content">      JWT_SECRET: secret-key</span></div>
<div class="code-line" data-line="214"><span class="line-number">214</span><span class="line-content">    depends_on:</span></div>
<div class="code-line" data-line="215"><span class="line-number">215</span><span class="line-content">      - db</span></div>
<div class="code-line" data-line="216"><span class="line-number">216</span><span class="line-content">  db:</span></div>
<div class="code-line" data-line="217"><span class="line-number">217</span><span class="line-content">    image: mongo</span></div>
<div class="code-line" data-line="218"><span class="line-number">218</span><span class="line-content">    volumes:</span></div>
<div class="code-line" data-line="219"><span class="line-number">219</span><span class="line-content">      - db-data:/data/db</span></div>
<div class="code-line" data-line="220"><span class="line-number">220</span><span class="line-content">volumes:</span></div>
<div class="code-line" data-line="221"><span class="line-number">221</span><span class="line-content">  db-data:</span></div>

                </div>
            </div>
        </div>
    </div>
    
    <script>
        // XEdit data and state
        const xeditPaths = {"7x001": {"display_name": "authMiddleware", "type": "function", "filename": "middleware/authMiddleware.js", "language": "javascript", "line_start": 3, "line_end": 13, "lines_display": "3-13", "technical_path": "middleware/authMiddleware.js::function.authMiddleware/lines[3-13]", "optimal_model": "llama-3.1-70b-versatile"}};
        const projectFiles = [{"filename":"server.js","language":"javascript","code_b64":"Y29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTsKY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpOwpjb25zdCBjb3JzID0gcmVxdWlyZSgnY29ycycpOwpjb25zdCBkb3RlbnYgPSByZXF1aXJlKCdkb3RlbnYnKTsKCmRvdGVudi5jb25maWcoKTsKCmNvbnN0IGFwcCA9IGV4cHJlc3MoKTsKCi8vIENvbm5lY3QgdG8gTW9uZ29EQgptb25nb29zZS5jb25uZWN0KHByb2Nlc3MuZW52LkRCX1VSSSwgewogIHVzZU5ld1VybFBhcnNlcjogdHJ1ZSwKICB1c2VVbmlmaWVkVG9wb2xvZ3k6IHRydWUKfSk7CgovLyBNaWRkbGV3YXJlCmFwcC51c2UoY29ycygpKTsKYXBwLnVzZShleHByZXNzLmpzb24oKSk7CgovLyBSb3V0ZXMKYXBwLnVzZSgnL2FwaS91c2VycycsIHJlcXVpcmUoJy4vcm91dGVzL3VzZXJSb3V0ZXMnKSk7CgovLyBFcnJvciBoYW5kbGluZyBtaWRkbGV3YXJlCmFwcC51c2UoKGVyciwgcmVxLCByZXMsIG5leHQpID0+IHsKICBjb25zb2xlLmVycm9yKGVyci5zdGFjayk7CiAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0ludGVybmFsIFNlcnZlciBFcnJvcicgfSk7Cn0pOwoKY29uc3QgUE9SVCA9IHByb2Nlc3MuZW52LlBPUlQgfHwgMzAwMDsKYXBwLmxpc3RlbihQT1JULCAoKSA9PiB7CiAgY29uc29sZS5sb2coYFNlcnZlciBydW5uaW5nIG9uIHBvcnQgJHtQT1JUfWApOwp9KTs=","code":""},{"filename":"models/User.js","language":"javascript","code_b64":"Y29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpOwpjb25zdCBiY3J5cHQgPSByZXF1aXJlKCdiY3J5cHRqcycpOwoKY29uc3QgdXNlclNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoewogIGVtYWlsOiB7CiAgICB0eXBlOiBTdHJpbmcsCiAgICByZXF1aXJlZDogdHJ1ZSwKICAgIHVuaXF1ZTogdHJ1ZSwKICAgIHRyaW06IHRydWUsCiAgICBsb3dlcmNhc2U6IHRydWUKICB9LAogIHBhc3N3b3JkOiB7CiAgICB0eXBlOiBTdHJpbmcsCiAgICByZXF1aXJlZDogdHJ1ZSwKICAgIG1pbmxlbmd0aDogOAogIH0sCiAgdG9rZW5zOiBbewogICAgdG9rZW46IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICByZXF1aXJlZDogdHJ1ZQogICAgfQogIH1dCn0pOwoKLy8gSGFzaCBwYXNzd29yZCBiZWZvcmUgc2F2aW5nCnVzZXJTY2hlbWEucHJlKCdzYXZlJywgYXN5bmMgZnVuY3Rpb24gKG5leHQpIHsKICBpZiAodGhpcy5pc01vZGlmaWVkKCdwYXNzd29yZCcpKSB7CiAgICB0aGlzLnBhc3N3b3JkID0gYXdhaXQgYmNyeXB0Lmhhc2godGhpcy5wYXNzd29yZCwgOCk7CiAgfQogIG5leHQoKTsKfSk7Cgpjb25zdCBVc2VyID0gbW9uZ29vc2UubW9kZWwoJ1VzZXInLCB1c2VyU2NoZW1hKTsKbW9kdWxlLmV4cG9ydHMgPSBVc2VyOw==","code":""},{"filename":"controllers/userController.js","language":"javascript","code_b64":"Y29uc3QgVXNlciA9IHJlcXVpcmUoJy4uL21vZGVscy9Vc2VyJyk7CmNvbnN0IGp3dCA9IHJlcXVpcmUoJ2pzb253ZWJ0b2tlbicpOwpjb25zdCBiY3J5cHQgPSByZXF1aXJlKCdiY3J5cHRqcycpOwoKLy8gUmVnaXN0ZXIgdXNlcgpjb25zdCByZWdpc3RlclVzZXIgPSBhc3luYyAocmVxLCByZXMpID0+IHsKICB0cnkgewogICAgY29uc3QgeyBlbWFpbCwgcGFzc3dvcmQgfSA9IHJlcS5ib2R5OwogICAgY29uc3QgdXNlciA9IG5ldyBVc2VyKHsgZW1haWwsIHBhc3N3b3JkIH0pOwogICAgYXdhaXQgdXNlci5zYXZlKCk7CiAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7IG1lc3NhZ2U6ICdVc2VyIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyB9KTsKICB9IGNhdGNoIChlcnJvcikgewogICAgcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTsKICB9Cn07CgovLyBMb2dpbiB1c2VyCmNvbnN0IGxvZ2luVXNlciA9IGFzeW5jIChyZXEsIHJlcykgPT4gewogIHRyeSB7CiAgICBjb25zdCB7IGVtYWlsLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7CiAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kT25lKHsgZW1haWwgfSk7CiAgICBpZiAoIXVzZXIgfHwgIShhd2FpdCBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgdXNlci5wYXNzd29yZCkpKSB7CiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnSW52YWxpZCBjcmVkZW50aWFscycgfSk7CiAgICB9CiAgICBjb25zdCB0b2tlbiA9IGp3dC5zaWduKHsgaWQ6IHVzZXIuX2lkIH0sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQsIHsgZXhwaXJlc0luOiAnMWgnIH0pOwogICAgdXNlci50b2tlbnMucHVzaCh0b2tlbik7CiAgICBhd2FpdCB1c2VyLnNhdmUoKTsKICAgIHJlcy5qc29uKHsgdG9rZW4gfSk7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7CiAgfQp9OwoKLy8gUmVmcmVzaCB0b2tlbgpjb25zdCByZWZyZXNoVG9rZW4gPSBhc3luYyAocmVxLCByZXMpID0+IHsKICB0cnkgewogICAgY29uc3QgeyB0b2tlbiB9ID0gcmVxLmJvZHk7CiAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCk7CiAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChkZWNvZGVkLmlkKTsKICAgIGlmICghdXNlcikgewogICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgdG9rZW4nIH0pOwogICAgfQogICAgY29uc3QgbmV3VG9rZW4gPSBqd3Quc2lnbih7IGlkOiB1c2VyLl9pZCB9LCBwcm9jZXNzLmVudi5KV1RfU0VDUkVULCB7IGV4cGlyZXNJbjogJzFoJyB9KTsKICAgIHJlcy5qc29uKHsgdG9rZW46IG5ld1Rva2VuIH0pOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnSW52YWxpZCB0b2tlbicgfSk7CiAgfQp9OwoKbW9kdWxlLmV4cG9ydHMgPSB7IHJlZ2lzdGVyVXNlciwgbG9naW5Vc2VyLCByZWZyZXNoVG9rZW4gfTs=","code":""},{"filename":"routes/userRoutes.js","language":"javascript","code_b64":"Y29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTsKY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTsKY29uc3QgeyByZWdpc3RlclVzZXIsIGxvZ2luVXNlciwgcmVmcmVzaFRva2VuIH0gPSByZXF1aXJlKCcuLi9jb250cm9sbGVycy91c2VyQ29udHJvbGxlcicpOwpjb25zdCBhdXRoTWlkZGxld2FyZSA9IHJlcXVpcmUoJy4uL21pZGRsZXdhcmUvYXV0aE1pZGRsZXdhcmUnKTsKCi8vIFB1YmxpYyByb3V0ZXMKcm91dGVyLnBvc3QoJy9yZWdpc3RlcicsIHJlZ2lzdGVyVXNlcik7CnJvdXRlci5wb3N0KCcvbG9naW4nLCBsb2dpblVzZXIpOwoKLy8gUHJvdGVjdGVkIHJvdXRlCnJvdXRlci5wb3N0KCcvcmVmcmVzaC10b2tlbicsIGF1dGhNaWRkbGV3YXJlLCByZWZyZXNoVG9rZW4pOwoKbW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7","code":""},{"filename":"middleware/authMiddleware.js","language":"javascript","code_b64":"Y29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7Cgpjb25zdCBhdXRoTWlkZGxld2FyZSA9IChyZXEsIHJlcywgbmV4dCkgPT4gewogIGNvbnN0IHRva2VuID0gcmVxLmhlYWRlcnNbJ3gtYWNjZXNzLXRva2VuJ107CiAgaWYgKCF0b2tlbikgewogICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdObyB0b2tlbiBwcm92aWRlZCcgfSk7CiAgfQogIHRyeSB7CiAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCk7CiAgICByZXEudXNlcklkID0gZGVjb2RlZC5pZDsKICAgIG5leHQoKTsKICB9IGNhdGNoIChlcnJvcikgewogICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgdG9rZW4nIH0pOwogIH0KfTsKCm1vZHVsZS5leHBvcnRzID0gYXV0aE1pZGRsZXdhcmU7","code":""},{"filename":"tests/userController.test.js","language":"javascript","code_b64":"Y29uc3QgcmVxdWVzdCA9IHJlcXVpcmUoJ3N1cGVydGVzdCcpOwpjb25zdCBhcHAgPSByZXF1aXJlKCcuLi9zZXJ2ZXInKTsKY29uc3QgVXNlciA9IHJlcXVpcmUoJy4uL21vZGVscy9Vc2VyJyk7CmNvbnN0IGp3dCA9IHJlcXVpcmUoJ2pzb253ZWJ0b2tlbicpOwoKZGVzY3JpYmUoJ1VzZXIgQ29udHJvbGxlciBUZXN0cycsICgpID0+IHsKICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHsKICAgIGF3YWl0IFVzZXIuZGVsZXRlTWFueSh7fSk7CiAgfSk7CgogIHRlc3QoJ1Nob3VsZCByZWdpc3RlciBhIG5ldyB1c2VyJywgYXN5bmMgKCkgPT4gewogICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChhcHApCiAgICAgIC5wb3N0KCcvYXBpL3VzZXJzL3JlZ2lzdGVyJykKICAgICAgLnNlbmQoewogICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsCiAgICAgICAgcGFzc3dvcmQ6ICdQYXNzd29yZDEyMyEnCiAgICAgIH0pOwogICAgZXhwZWN0KHJlcy5zdGF0dXNDb2RlKS50b0JlKDIwMSk7CiAgICBleHBlY3QocmVzLmJvZHkubWVzc2FnZSkudG9CZSgnVXNlciBjcmVhdGVkIHN1Y2Nlc3NmdWxseScpOwogIH0pOwoKICB0ZXN0KCdTaG91bGQgbG9naW4gd2l0aCB2YWxpZCBjcmVkZW50aWFscycsIGFzeW5jICgpID0+IHsKICAgIC8vIEZpcnN0IGNyZWF0ZSBhIHVzZXIKICAgIGF3YWl0IHJlcXVlc3QoYXBwKQogICAgICAucG9zdCgnL2FwaS91c2Vycy9yZWdpc3RlcicpCiAgICAgIC5zZW5kKHsKICAgICAgICBlbWFpbDogJ2xvZ2luQGV4YW1wbGUuY29tJywKICAgICAgICBwYXNzd29yZDogJ1Bhc3N3b3JkMTIzIScKICAgICAgfSk7CgogICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChhcHApCiAgICAgIC5wb3N0KCcvYXBpL3VzZXJzL2xvZ2luJykKICAgICAgLnNlbmQoewogICAgICAgIGVtYWlsOiAnbG9naW5AZXhhbXBsZS5jb20nLAogICAgICAgIHBhc3N3b3JkOiAnUGFzc3dvcmQxMjMhJwogICAgICB9KTsKICAgIGV4cGVjdChyZXMuc3RhdHVzQ29kZSkudG9CZSgyMDApOwogICAgZXhwZWN0KHJlcy5ib2R5KS50b0hhdmVQcm9wZXJ0eSgndG9rZW4nKTsKICB9KTsKCiAgdGVzdCgnU2hvdWxkIHJldHVybiBlcnJvciBmb3IgaW52YWxpZCBsb2dpbicsIGFzeW5jICgpID0+IHsKICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKQogICAgICAucG9zdCgnL2FwaS91c2Vycy9sb2dpbicpCiAgICAgIC5zZW5kKHsKICAgICAgICBlbWFpbDogJ2ludmFsaWRAZXhhbXBsZS5jb20nLAogICAgICAgIHBhc3N3b3JkOiAnd3JvbmdwYXNzd29yZCcKICAgICAgfSk7CiAgICBleHBlY3QocmVzLnN0YXR1c0NvZGUpLnRvQmUoNDAxKTsKICAgIGV4cGVjdChyZXMuYm9keS5lcnJvcikudG9CZSgnSW52YWxpZCBjcmVkZW50aWFscycpOwogIH0pOwp9KTs=","code":""},{"filename":"docker/Dockerfile","language":"text","code_b64":"RlJPTSBub2RlOjE4CldPUktESVIgL2FwcApDT1BZIHBhY2thZ2UqLmpzb24gLi8KUlVOIG5wbSBpbnN0YWxsCkNPUFkgLiAuCkVYUE9TRSAzMDAwCkNNRCBbIm5vZGUiLCAic2VydmVyLmpzIl0=","code":""},{"filename":"docker/docker-compose.yml","language":"yaml","code_b64":"dmVyc2lvbjogJzMnCnNlcnZpY2VzOgogIGFwcDoKICAgIGJ1aWxkOiAuCiAgICBwb3J0czoKICAgICAgLSAiMzAwMDozMDAwIgogICAgZW52aXJvbm1lbnQ6CiAgICAgIERCX1VSSTogbW9uZ29kYjovL2RiOjI3MDE3L3Jlc3RmdWwtYXBpCiAgICAgIEpXVF9TRUNSRVQ6IHNlY3JldC1rZXkKICAgIGRlcGVuZHNfb246CiAgICAgIC0gZGIKICBkYjoKICAgIGltYWdlOiBtb25nbwogICAgdm9sdW1lczoKICAgICAgLSBkYi1kYXRhOi9kYXRhL2RiCnZvbHVtZXM6CiAgZGItZGF0YTo=","code":""}];
        const projectName = 'Untitled Peacock Project';
        const sessionId = 'deepseek-range5-20250712-011107';
        let payloadItems = [];
        
        function highlightFunction(xeditId, functionName, lineStart, lineEnd) {
            console.log(`Highlighting function: ${functionName} (lines ${lineStart}-${lineEnd})`);
            
            // Remove previous highlights from function list
            document.querySelectorAll('.function-item').forEach(item => {
                item.classList.remove('highlighted');
            });
            
            // Highlight selected function
            const selectedItem = document.querySelector(`[data-id="${xeditId}"]`);
            if (selectedItem) {
                selectedItem.classList.add('highlighted');
            }
            
            // Clear previous code highlights
            document.querySelectorAll('.code-line').forEach(line => {
                line.classList.remove('highlight');
            });
            
            // Highlight code lines
            for (let i = lineStart; i <= lineEnd; i++) {
                const lineElement = document.querySelector(`.code-line[data-line="${i}"]`);
                if (lineElement) {
                    lineElement.classList.add('highlight');
                    
                    // Scroll to first highlighted line
                    if (i === lineStart) {
                        lineElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            }
        }
        
        function addToPayload(functionName, functionType, xeditId) {
            console.log(`Adding to payload: ${functionName} (${functionType})`);
            
            // Check if already in payload
            if (payloadItems.find(item => item.id === xeditId)) {
                alert('Function already in payload!');
                return;
            }
            
            // Add to payload
            const payloadItem = {
                id: xeditId,
                name: functionName,
                type: functionType,
                timestamp: new Date().toLocaleTimeString()
            };
            
            payloadItems.push(payloadItem);
            updatePayloadDisplay();
        }
        
        function removeFromPayload(xeditId) {
            payloadItems = payloadItems.filter(item => item.id !== xeditId);
            updatePayloadDisplay();
        }
        
        function updatePayloadDisplay() {
            const payloadList = document.getElementById('payload-list');
            const sendButton = document.getElementById('send-button');
            
            if (payloadItems.length === 0) {
                payloadList.innerHTML = '<div class="payload-empty">Click functions to add XEdit-Paths</div>';
                sendButton.textContent = 'üöÄ Send 0 to Optimized Pipeline';
                sendButton.disabled = true;
                return;
            }
            
            let html = '';
            payloadItems.forEach(item => {
                html += `
                    <div class="payload-item">
                        <div class="payload-item-info">
                            <div class="xedit-id">${item.id}</div>
                            <div class="payload-model">${item.name} (${item.type})</div>
                        </div>
                        <button class="remove-btn" onclick="removeFromPayload('${item.id}')" title="Remove from payload">√ó</button>
                    </div>
                `;
            });
            
            payloadList.innerHTML = html;
            sendButton.textContent = `üöÄ Send ${payloadItems.length} to Optimized Pipeline`;
            sendButton.disabled = false;
        }
        
        function deployToPcock() {
            console.log('deployToPcock() called');
            const deployBtn = document.querySelector('.peacock-deploy-btn');
            const deployStatus = document.getElementById('deploy-status');
            const customNameInput = document.getElementById('custom-package-name');
            
            // Get custom name or use default
            const customName = customNameInput.value.trim();
            const finalProjectName = customName || projectName;
            
            // Show loading state
            deployBtn.disabled = true;
            deployBtn.textContent = 'üîÑ Building...'
            deployStatus.innerHTML = '<div style="color: #ffff00;">üîß Preparing build...</div>';
            
            // Prepare deployment data
            const deploymentData = {
                project_name: finalProjectName,
                session_id: sessionId,
                project_files: projectFiles,
                payload_items: payloadItems,
                timestamp: new Date().toISOString()
            };
            
            // Call deployment API
            fetch('http://127.0.0.1:8000/deploy', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(deploymentData)
            })
            .then(response => {
                console.log('Response status:', response.status);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Deploy response:', data);
                if (data.success) {
                    deployBtn.textContent = '‚úÖ Built!';
                    deployBtn.style.background = 'linear-gradient(45deg, #00ff00, #00cc00)';
                    deployStatus.innerHTML = `
                        <div style="color: #00ff00;">
                            ‚úÖ Build successful!<br>
                            üì¶ Project created<br>
                            üöÄ Ready to run
                        </div>
                    `;
                } else {
                    throw new Error(data.error || 'Deployment failed');
                }
            })
            .catch(error => {
                console.error('Deploy error:', error);
                deployBtn.textContent = '‚ùå Build Failed';
                deployBtn.style.background = 'linear-gradient(45deg, #ff0000, #cc0000)';
                deployStatus.innerHTML = `
                    <div style="color: #ff0000;">
                        ‚ùå Build failed:<br>
                        ${error.message}
                    </div>
                `;
            })
            .finally(() => {
                deployBtn.disabled = false;
                setTimeout(() => {
                    deployBtn.textContent = 'ü¶ö Generate Python Project';
                    deployBtn.style.background = 'linear-gradient(45deg, #00ff00, #00cc00)';
                }, 4000);
            });
        }
        
        // Decode base64 project files
        projectFiles.forEach(file => {
            if (file.code_b64) {
                file.code = atob(file.code_b64);
                delete file.code_b64;
            }
        });
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ü¶ö XEdit Enhanced Interface Loaded');
            console.log('Project:', projectName);
            console.log('Session:', sessionId);
            console.log('Functions found:', Object.keys(xeditPaths).length);
            console.log('Project files:', projectFiles.length);
        });
    </script>
</body>
</html>